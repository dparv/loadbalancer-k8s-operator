type: charm
name: loadbalancer-k8s
title: Kubernetes LoadBalancer service
summary: A simple LoadBalancer charm for Kubernetes services
description: |
  This charm deploys a simple LoadBalancer service for Kubernetes pods
  matching a specified selector. It allows configuration of the target port
  on the pods and the port to expose the load balancer on.

  Read more about usage on: https://github.com/dparv/loadbalancer-k8s-operator

base: ubuntu@24.04
platforms:
  amd64:

parts:
  charm:
    plugin: uv
    source: .
    build-snaps:
      - astral-uv

config:
  options:
    selector:
      description: |
        The kubernetes selector to identify the pods to load balance.
      type: string
      default: "app.kubernetes.io/name=myapp"
    target-port:
      description: |
        The port on the pods to load balance to.
      type: int
      default: 80
    lb-port:
      description: |
        The port to expose the load balancer on.
      type: int
      default: 80
    loadbalancer-annotations:
      description: |
        Comma-separated Kubernetes Service annotations applied to the LoadBalancer.
        Format: "key1=value1,key2=value2".
      type: string
      default: ""
    fixed-ip:
      description: |
        Optional fixed IP address to assign to the Kubernetes LoadBalancer Service.
        If set, this is applied as `.spec.loadBalancerIP`.
        Must be a valid IPv4 or IPv6 address.
      type: string
      default: ""

containers:
  hello-world:
    resource: image

resources:
  image:
    type: oci-image
    description: Dummy pause image (keeps the pod running).
    upstream-source: registry.k8s.io/pause:3.9
